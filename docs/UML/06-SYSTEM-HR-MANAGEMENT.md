# S∆° ƒê·ªì UML - Qu·∫£n Tr·ªã H·ªá Th·ªëng v√† Nh√¢n S·ª± (System & HR Management)

## üìã T·ªïng Quan Module

Module qu·∫£n tr·ªã h·ªá th·ªëng v√† nh√¢n s·ª± cung c·∫•p c√¥ng c·ª• qu·∫£n l√Ω to√†n di·ªán cho qu·∫£n tr·ªã vi√™n v√† c·∫•p qu·∫£n l√Ω, h·ªó tr·ª£ gi√°m s√°t, ph√¢n t√≠ch v√† ƒëi·ªÅu h√†nh ho·∫°t ƒë·ªông c·ªßa nh√† h√†ng m·ªôt c√°ch hi·ªáu qu·∫£, minh b·∫°ch v√† c√≥ t√≠nh h·ªá th·ªëng.

### Y√™u C·∫ßu Ch√≠nh
- ‚úÖ Dashboard t·ªïng quan v·ªõi c√°c ch·ªâ s·ªë ho·∫°t ƒë·ªông
- ‚úÖ Qu·∫£n l√Ω nh√¢n vi√™n (CRUD, ph√¢n quy·ªÅn, vai tr√≤)
- ‚úÖ Ph√¢n ca l√†m vi·ªác v√† ch·∫•m c√¥ng
- ‚úÖ T√≠nh l∆∞∆°ng t·ª± ƒë·ªông (l∆∞∆°ng, th∆∞·ªüng, ph·∫°t, ph·ª• c·∫•p)
- ‚úÖ B√°o c√°o nh√¢n s·ª± ƒë·ªãnh k·ª≥
- ‚úÖ Ph√¢n quy·ªÅn truy c·∫≠p chi ti·∫øt (RBAC)
- ‚úÖ Audit log v√† theo d√µi ho·∫°t ƒë·ªông

---

## 1Ô∏è‚É£ Use Case Diagram - S∆° ƒê·ªì Ca S·ª≠ D·ª•ng

```mermaid
graph TB
    subgraph "H·ªá Th·ªëng Qu·∫£n Tr·ªã & Nh√¢n S·ª±"
        UC1((Xem Dashboard))
        UC2((Qu·∫£n L√Ω Nh√¢n Vi√™n))
        UC3((Ph√¢n Quy·ªÅn))
        UC4((Ph√¢n Ca L√†m Vi·ªác))
        UC5((Ch·∫•m C√¥ng))
        UC6((T√≠nh L∆∞∆°ng))
        UC7((Qu·∫£n L√Ω Th∆∞·ªüng Ph·∫°t))
        UC8((B√°o C√°o Nh√¢n S·ª±))
        UC9((Qu·∫£n L√Ω Vai Tr√≤))
        UC10((Xem Audit Log))
        UC11((Sao L∆∞u D·ªØ Li·ªáu))
    end
    
    Admin[üë®‚Äçüíº Qu·∫£n Tr·ªã Vi√™n]
    Manager[üëî Qu·∫£n L√Ω]
    HR[üë• Nh√¢n S·ª±]
    Employee[üë§ Nh√¢n Vi√™n]
    System[ü§ñ H·ªá Th·ªëng]
    
    Admin --> UC1
    Admin --> UC2
    Admin --> UC3
    Admin --> UC9
    Admin --> UC10
    Admin --> UC11
    
    Manager --> UC1
    Manager --> UC2
    Manager --> UC4
    Manager --> UC7
    Manager --> UC8
    
    HR --> UC2
    HR --> UC4
    HR --> UC5
    HR --> UC6
    HR --> UC8
    
    Employee --> UC5
    
    UC2 -.->|include| UC3
    UC6 -.->|include| UC5
    UC6 -.->|include| UC7
    
    System --> UC6
```

### Gi·∫£i Th√≠ch Use Case

| Use Case | Actor | M√¥ T·∫£ |
|----------|-------|-------|
| **Xem Dashboard** | Admin, Qu·∫£n l√Ω | Xem t·ªïng quan ho·∫°t ƒë·ªông, KPIs, bi·ªÉu ƒë·ªì |
| **Qu·∫£n L√Ω Nh√¢n Vi√™n** | Admin, Qu·∫£n l√Ω, HR | CRUD th√¥ng tin nh√¢n vi√™n |
| **Ph√¢n Quy·ªÅn** | Admin | G√°n quy·ªÅn truy c·∫≠p cho t·ª´ng nh√¢n vi√™n |
| **Ph√¢n Ca L√†m Vi·ªác** | Qu·∫£n l√Ω, HR | S·∫Øp x·∫øp l·ªãch l√†m vi·ªác cho nh√¢n vi√™n |
| **Ch·∫•m C√¥ng** | HR, Nh√¢n vi√™n | Ghi nh·∫≠n gi·ªù v√†o/ra, ngh·ªâ ph√©p |
| **T√≠nh L∆∞∆°ng** | HR, H·ªá th·ªëng | T·ª± ƒë·ªông t√≠nh l∆∞∆°ng theo c√¥ng, th∆∞·ªüng, ph·∫°t |
| **Qu·∫£n L√Ω Th∆∞·ªüng Ph·∫°t** | Qu·∫£n l√Ω | Ghi nh·∫≠n khen th∆∞·ªüng/k·ª∑ lu·∫≠t |
| **B√°o C√°o Nh√¢n S·ª±** | Qu·∫£n l√Ω, HR | B√°o c√°o ch·∫•m c√¥ng, l∆∞∆°ng, hi·ªáu su·∫•t |
| **Qu·∫£n L√Ω Vai Tr√≤** | Admin | T·∫°o/s·ª≠a role v·ªõi permissions |
| **Xem Audit Log** | Admin | Theo d√µi m·ªçi thao t√°c trong h·ªá th·ªëng |
| **Sao L∆∞u D·ªØ Li·ªáu** | Admin | Backup/restore database |

---

## 2Ô∏è‚É£ Activity Diagram - Quy Tr√¨nh Qu·∫£n L√Ω Nh√¢n Vi√™n

```mermaid
flowchart TD
    Start([B·∫Øt ƒê·∫ßu]) --> A1{H√†nh ƒë·ªông?}
    
    A1 -->|T·∫°o nh√¢n vi√™n m·ªõi| A2[HR/Admin nh·∫≠p th√¥ng tin<br/>nh√¢n vi√™n m·ªõi]
    A1 -->|C·∫≠p nh·∫≠t th√¥ng tin| A3[Ch·ªçn nh√¢n vi√™n c·∫ßn c·∫≠p nh·∫≠t]
    A1 -->|X√≥a/V√¥ hi·ªáu h√≥a| A4[Ch·ªçn nh√¢n vi√™n c·∫ßn x√≥a]
    
    A2 --> A5[Nh·∫≠p th√¥ng tin c∆° b·∫£n:<br/>- H·ªç t√™n<br/>- CMND/CCCD<br/>- Ng√†y sinh<br/>- ƒê·ªãa ch·ªâ<br/>- ƒêi·ªán tho·∫°i<br/>- Email]
    A3 --> A5
    
    A5 --> A6[Nh·∫≠p th√¥ng tin c√¥ng vi·ªác:<br/>- V·ªã tr√≠<br/>- Ph√≤ng ban<br/>- Ng√†y b·∫Øt ƒë·∫ßu<br/>- Lo·∫°i h·ª£p ƒë·ªìng<br/>- L∆∞∆°ng c∆° b·∫£n]
    
    A6 --> A7[T·∫°o t√†i kho·∫£n ƒëƒÉng nh·∫≠p:<br/>- Username<br/>- Email<br/>- Password t·∫°m th·ªùi]
    
    A7 --> A8[Ph√¢n quy·ªÅn v√† vai tr√≤]
    A8 --> A9{Vai tr√≤?}
    
    A9 -->|Super Admin| A10[G√°n role: super_admin<br/>Full permissions]
    A9 -->|Manager| A11[G√°n role: manager<br/>Management permissions]
    A9 -->|Staff| A12[G√°n role: staff<br/>Basic permissions]
    A9 -->|Waiter/Kitchen/Cashier| A13[G√°n role theo b·ªô ph·∫≠n]
    
    A10 --> A14[Ki·ªÉm tra v√† x√°c nh·∫≠n<br/>th√¥ng tin]
    A11 --> A14
    A12 --> A14
    A13 --> A14
    
    A14 --> A15{Th√¥ng tin h·ª£p l·ªá?}
    A15 -->|Kh√¥ng| A16[Hi·ªÉn th·ªã l·ªói validation]
    A16 --> A5
    
    A15 -->|C√≥| A17[L∆∞u v√†o database<br/>Status = Active]
    A17 --> A18[T·∫°o m√£ nh√¢n vi√™n<br/>EMP-xxxxx]
    
    A18 --> A19[G·ª≠i email ch√†o m·ª´ng:<br/>- Username<br/>- Password t·∫°m<br/>- Link ƒë·ªïi MK<br/>- Th√¥ng tin onboarding]
    
    A19 --> A20[T·∫°o h·ªì s∆° nh√¢n vi√™n<br/>trong HRM system]
    A20 --> A21[Th√¥ng b√°o cho<br/>qu·∫£n l√Ω tr·ª±c ti·∫øp]
    
    A21 --> A22{Nh√¢n vi√™n m·ªõi?}
    A22 -->|C√≥| A23[T·∫°o l·ªãch ƒë√†o t·∫°o<br/>onboarding]
    A23 --> A24[G√°n mentor]
    A24 --> A25[Chu·∫©n b·ªã trang thi·∫øt b·ªã:<br/>- ƒê·ªìng ph·ª•c<br/>- Thi·∫øt b·ªã l√†m vi·ªác<br/>- T√†i kho·∫£n h·ªá th·ªëng]
    
    A22 -->|Kh√¥ng| A26[L∆∞u l·ªãch s·ª≠ thay ƒë·ªïi]
    A25 --> A26
    
    A4 --> A27{X√≥a hay v√¥ hi·ªáu h√≥a?}
    A27 -->|X√≥a vƒ©nh vi·ªÖn| A28[Ki·ªÉm tra r√†ng bu·ªôc<br/>d·ªØ li·ªáu]
    A28 --> A29{C√≥ d·ªØ li·ªáu li√™n quan?}
    A29 -->|C√≥| A30[‚ö†Ô∏è Kh√¥ng th·ªÉ x√≥a<br/>ƒê·ªÅ xu·∫•t v√¥ hi·ªáu h√≥a]
    A30 --> A27
    
    A29 -->|Kh√¥ng| A31[X√°c nh·∫≠n x√≥a<br/>t·ª´ Gi√°m ƒë·ªëc]
    A31 --> A32{X√°c nh·∫≠n?}
    A32 -->|Kh√¥ng| End1([K·∫øt Th√∫c])
    A32 -->|C√≥| A33[X√≥a nh√¢n vi√™n<br/>v√† t√†i kho·∫£n]
    
    A27 -->|V√¥ hi·ªáu h√≥a| A34[C·∫≠p nh·∫≠t Status = Inactive]
    A34 --> A35[V√¥ hi·ªáu h√≥a t√†i kho·∫£n<br/>ƒëƒÉng nh·∫≠p]
    A35 --> A36[Ghi l√Ω do ngh·ªâ vi·ªác]
    A36 --> A37[T√≠nh to√°n l∆∞∆°ng th√°ng cu·ªëi<br/>v√† thanh to√°n]
    
    A33 --> End2([K·∫øt Th√∫c])
    A26 --> End2
    A37 --> End2

    style A15 fill:#ffcc99
    style A29 fill:#ff9999
    style A32 fill:#ff9999
    style A17 fill:#99ff99
```

```
@startuml
start

:X√°c ƒë·ªãnh h√†nh ƒë·ªông nh√¢n s·ª±;

if (T·∫°o nh√¢n vi√™n m·ªõi?) then (C√≥)
    :Nh·∫≠p th√¥ng tin c∆° b·∫£n & c√¥ng vi·ªác;
    :T·∫°o t√†i kho·∫£n v√† ph√¢n quy·ªÅn;
    if (Th√¥ng tin h·ª£p l·ªá?) then (C√≥)
        :L∆∞u v√†o h·ªá th·ªëng;
        :Onboarding nh√¢n vi√™n m·ªõi;
    else (Kh√¥ng)
        :Hi·ªÉn th·ªã l·ªói v√† nh·∫≠p l·∫°i;
    endif

elseif (C·∫≠p nh·∫≠t th√¥ng tin?) then (C√≥)
    :Ch·ªçn nh√¢n vi√™n v√† c·∫≠p nh·∫≠t;
    :L∆∞u l·ªãch s·ª≠ thay ƒë·ªïi;

elseif (X√≥a/V√¥ hi·ªáu h√≥a?) then (C√≥)
    if (X√≥a vƒ©nh vi·ªÖn?) then (C√≥)
        :Ki·ªÉm tra r√†ng bu·ªôc d·ªØ li·ªáu;
        if (C√≥ d·ªØ li·ªáu li√™n quan?) then (C√≥)
            :ƒê·ªÅ xu·∫•t v√¥ hi·ªáu h√≥a;
        else (Kh√¥ng)
            :X√°c nh·∫≠n v√† x√≥a nh√¢n vi√™n;
        endif
    else (V√¥ hi·ªáu h√≥a)
        :C·∫≠p nh·∫≠t tr·∫°ng th√°i Inactive;
        :Ghi l√Ω do ngh·ªâ vi·ªác v√† thanh to√°n cu·ªëi;
    endif
endif

stop
@enduml

```

---

## 3Ô∏è‚É£ Activity Diagram - Quy Tr√¨nh Ch·∫•m C√¥ng v√† T√≠nh L∆∞∆°ng

```mermaid
flowchart TD
    Start([B·∫Øt ƒê·∫ßu Th√°ng]) --> A1[Nh√¢n vi√™n check-in<br/>h√†ng ng√†y]
    A1 --> A2[H·ªá th·ªëng ghi nh·∫≠n:<br/>- Th·ªùi gian v√†o<br/>- Th·ªùi gian ra<br/>- GPS location]
    
    A2 --> A3{Ca l√†m vi·ªác?}
    A3 -->|ƒê√∫ng ca| A4[ƒê√°nh d·∫•u: ƒê√∫ng gi·ªù ‚úÖ]
    A3 -->|Tr·ªÖ < 15 ph√∫t| A5[ƒê√°nh d·∫•u: Tr·ªÖ ‚ö†Ô∏è<br/>Kh√¥ng ph·∫°t]
    A3 -->|Tr·ªÖ > 15 ph√∫t| A6[ƒê√°nh d·∫•u: Tr·ªÖ mu·ªôn ‚ùå<br/>Ph·∫°t theo quy ƒë·ªãnh]
    
    A4 --> A7[T√≠nh gi·ªù c√¥ng trong ng√†y]
    A5 --> A7
    A6 --> A7
    
    A7 --> A8{L√†m th√™m gi·ªù?}
    A8 -->|C√≥| A9[T√≠nh overtime:<br/>- Gi·ªù th∆∞·ªùng: 150%<br/>- Cu·ªëi tu·∫ßn: 200%<br/>- L·ªÖ: 300%]
    A8 -->|Kh√¥ng| A10[Ghi nh·∫≠n c√¥ng chu·∫©n]
    
    A9 --> A11[L∆∞u v√†o b·∫£ng timesheet]
    A10 --> A11
    
    A11 --> A12{H·∫øt th√°ng?}
    A12 -->|Ch∆∞a| A1
    
    A12 -->|R·ªìi| A13[HR kh√≥a b·∫£ng ch·∫•m c√¥ng<br/>c·ªßa th√°ng]
    A13 --> A14[T·ªïng h·ª£p:<br/>- T·ªïng ng√†y c√¥ng<br/>- T·ªïng gi·ªù OT<br/>- S·ªë ng√†y ngh·ªâ<br/>- S·ªë l·∫ßn ƒëi mu·ªôn]
    
    A14 --> A15[H·ªá th·ªëng t·ª± ƒë·ªông t√≠nh l∆∞∆°ng]
    A15 --> A16[L∆∞∆°ng c∆° b·∫£n<br/>= base_salary √ó (working_days / standard_days)]
    
    A16 --> A17[Ph·ª• c·∫•p<br/>= allowances]
    A17 --> A18[L∆∞∆°ng OT<br/>= hourly_rate √ó OT_hours √ó rate]
    
    A18 --> A19[Th∆∞·ªüng<br/>= bonuses trong th√°ng]
    A19 --> A20[Ph·∫°t<br/>= penalties trong th√°ng]
    
    A20 --> A21[T·ªïng l∆∞∆°ng<br/>= base + allowances + OT + bonuses - penalties]
    A21 --> A22[Kh·∫•u tr·ª´:<br/>- BHXH (8%)<br/>- BHYT (1.5%)<br/>- BHTN (1%)<br/>- Thu·∫ø TNCN]
    
    A22 --> A23[L∆∞∆°ng th·ª±c nh·∫≠n<br/>= total - deductions]
    
    A23 --> A24[T·∫°o payslip<br/>cho t·ª´ng nh√¢n vi√™n]
    A24 --> A25[G·ª≠i email payslip]
    A25 --> A26[Qu·∫£n l√Ω duy·ªát<br/>b·∫£ng l∆∞∆°ng]
    
    A26 --> A27{Duy·ªát?}
    A27 -->|Kh√¥ng| A28[Ghi ch√∫ l√Ω do<br/>Y√™u c·∫ßu ch·ªânh s·ª≠a]
    A28 --> A15
    
    A27 -->|C√≥| A29[Chuy·ªÉn kho·∫£n l∆∞∆°ng<br/>v√†o ng√†y 5 th√°ng sau]
    A29 --> A30[C·∫≠p nh·∫≠t tr·∫°ng th√°i<br/>Payroll = Paid]
    
    A30 --> A31[L∆∞u b√°o c√°o l∆∞∆°ng]
    A31 --> A32[G·ª≠i cho k·∫ø to√°n]
    A32 --> End([K·∫øt Th√∫c])

    style A27 fill:#ff9999
    style A23 fill:#99ff99
    style A29 fill:#99ccff
```

---

## 4Ô∏è‚É£ Sequence Diagram - Quy Tr√¨nh Ch·∫•m C√¥ng H√†ng Ng√†y

```mermaid
sequenceDiagram
    actor E as üë§ Nh√¢n Vi√™n
    participant App as üì± Mobile App
    participant API as üîß API Gateway
    participant AttSvc as ‚è∞ Attendance Service
    participant ShiftSvc as üìÖ Shift Service
    participant Cache as üíæ Redis
    participant DB as üíæ Database
    participant Notif as üîî Notification Service

    Note over E,DB: ‚îÅ‚îÅ‚îÅ CHECK-IN BU·ªîI S√ÅNG ‚îÅ‚îÅ‚îÅ
    
    E->>App: 1. M·ªü app v√† nh·∫•n Check-in
    App->>App: L·∫•y GPS location
    
    App->>API: POST /api/attendance/check-in<br/>{employee_id, location, timestamp}
    API->>AttSvc: processCheckIn(data)
    
    AttSvc->>ShiftSvc: getEmployeeShift(employee_id, date)
    ShiftSvc->>DB: SELECT shift_assignment<br/>WHERE employee_id AND date
    DB-->>ShiftSvc: Shift data (ca s√°ng 06:00-14:00)
    ShiftSvc-->>AttSvc: Shift info
    
    AttSvc->>AttSvc: Validate location<br/>(trong b√°n k√≠nh 100m?)
    
    alt Location h·ª£p l·ªá
        AttSvc->>AttSvc: T√≠nh th·ªùi gian ƒë·∫øn:<br/>- ƒê√∫ng gi·ªù: 06:00-06:05 ‚úÖ<br/>- Tr·ªÖ nh·∫π: 06:05-06:15 ‚ö†Ô∏è<br/>- Tr·ªÖ mu·ªôn: > 06:15 ‚ùå
        
        AttSvc->>DB: BEGIN TRANSACTION
        activate DB
        
        AttSvc->>DB: INSERT INTO attendance<br/>(employee_id, check_in, status)
        
        alt Tr·ªÖ > 15 ph√∫t
            AttSvc->>DB: INSERT INTO penalties<br/>(employee_id, type, amount)
            Note over AttSvc: Ph·∫°t 50k-100k t√πy m·ª©c ƒë·ªô
        end
        
        AttSvc->>DB: COMMIT
        deactivate DB
        
        AttSvc->>Cache: SET attendance:{emp_id}:{date}<br/>status='checked_in'
        
        AttSvc-->>API: Check-in successful
        API-->>App: Success response
        App-->>E: ‚úÖ ƒê√£ ch·∫•m c√¥ng v√†o ca<br/>Gi·ªù: 06:03 (ƒê√∫ng gi·ªù)
        
        AttSvc->>Notif: sendNotification(manager)<br/>"NV [Name] ƒë√£ v√†o ca"
        Notif-->>E: üì± Th√¥ng b√°o cho qu·∫£n l√Ω
        
    else Location kh√¥ng h·ª£p l·ªá
        AttSvc-->>API: Error: Location invalid
        API-->>App: Error response
        App-->>E: ‚ùå B·∫°n kh√¥ng ·ªü trong khu v·ª±c<br/>nh√† h√†ng (>100m)
    end

    Note over E,DB: ‚îÅ‚îÅ‚îÅ CHECK-OUT BU·ªîI CHI·ªÄU ‚îÅ‚îÅ‚îÅ
    
    E->>App: 2. Nh·∫•n Check-out
    App->>API: POST /api/attendance/check-out<br/>{employee_id, timestamp}
    API->>AttSvc: processCheckOut(data)
    
    AttSvc->>Cache: GET attendance:{emp_id}:{date}
    Cache-->>AttSvc: Check-in data
    
    AttSvc->>AttSvc: T√≠nh t·ªïng gi·ªù l√†m:<br/>check_out - check_in - break_time
    
    AttSvc->>AttSvc: Ki·ªÉm tra overtime:<br/>N·∫øu > 8h ‚Üí t√≠nh OT
    
    AttSvc->>DB: UPDATE attendance<br/>SET check_out, total_hours,<br/>overtime_hours, status='completed'
    
    AttSvc->>Cache: UPDATE cache
    
    AttSvc-->>API: Check-out successful
    API-->>App: Success with summary
    App-->>E: ‚úÖ ƒê√£ checkout<br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>‚è∞ T·ªïng: 8.5 gi·ªù<br/>‚è±Ô∏è OT: 0.5 gi·ªù<br/>üí∞ L∆∞∆°ng OT: 75,000ƒë
```

```
@startuml
actor Employee as E
participant App as "Website"
participant API as "API Gateway"
participant AttendanceSvc as "Attendance Service"
participant ShiftSvc as "Shift Service"
participant DB as "Database"

== Check-in ==
E -> App: M·ªü app v√† nh·∫•n Check-in
App -> App: L·∫•y location
App -> API: G·ª≠i check-in (employee_id, location, timestamp)
API -> AttendanceSvc: X·ª≠ l√Ω check-in
AttendanceSvc -> ShiftSvc: L·∫•y ca l√†m vi·ªác c·ªßa nh√¢n vi√™n
ShiftSvc -> DB: Truy v·∫•n ca
DB --> ShiftSvc: Ca l√†m vi·ªác
ShiftSvc --> AttendanceSvc: Tr·∫£ ca
AttendanceSvc -> AttendanceSvc: Validate location & check-in time
alt Location h·ª£p l·ªá
    AttendanceSvc -> DB: Ghi nh·∫≠n check-in
    AttendanceSvc --> API: Check-in th√†nh c√¥ng
    API --> App: Ph·∫£n h·ªìi th√†nh c√¥ng
    App --> E: Hi·ªÉn th·ªã th√¥ng b√°o 
else Location kh√¥ng h·ª£p l·ªá
    AttendanceSvc --> API: L·ªói location
    API --> App: Ph·∫£n h·ªìi l·ªói
    App --> E: Hi·ªÉn th·ªã c·∫£nh b√°o
end

== Check-out ==
E -> App: Nh·∫•n Check-out
App -> API: G·ª≠i check-out
API -> AttendanceSvc: X·ª≠ l√Ω check-out
AttendanceSvc -> AttendanceSvc: T√≠nh t·ªïng gi·ªù l√†m & OT
AttendanceSvc -> DB: C·∫≠p nh·∫≠t check-out & gi·ªù l√†m
AttendanceSvc --> API: Check-out th√†nh c√¥ng
API --> App: Ph·∫£n h·ªìi th√†nh c√¥ng
App --> E: Hi·ªÉn th·ªã t·ªïng gi·ªù & OT
@enduml

```

---

## 5Ô∏è‚É£ Sequence Diagram - Quy Tr√¨nh T√≠nh L∆∞∆°ng Cu·ªëi Th√°ng

```mermaid
sequenceDiagram
    actor HR as üë• HR Manager
    participant App as üì± HR Portal
    participant API as üîß API Gateway
    participant PaySvc as üí∞ Payroll Service
    participant AttSvc as ‚è∞ Attendance Service
    participant BonusSvc as üéÅ Bonus Service
    participant DB as üíæ Database
    participant Mail as üìß Email Service
    participant Bank as üè¶ Banking API

    Note over HR,Bank: ‚îÅ‚îÅ‚îÅ NG√ÄY 1: KH√ìA CH·∫§M C√îNG ‚îÅ‚îÅ‚îÅ
    
    HR->>App: 1. Kh√≥a b·∫£ng ch·∫•m c√¥ng th√°ng 10
    App->>API: POST /api/attendance/lock<br/>{month: 10, year: 2025}
    API->>AttSvc: lockAttendance(month, year)
    
    AttSvc->>DB: UPDATE attendance<br/>SET locked=true<br/>WHERE month=10 AND year=2025
    
    AttSvc->>DB: INSERT INTO audit_log<br/>(action='ATTENDANCE_LOCKED')
    
    AttSvc-->>API: Locked successfully
    API-->>App: Success
    App-->>HR: ‚úÖ ƒê√£ kh√≥a ch·∫•m c√¥ng th√°ng 10<br/>Kh√¥ng th·ªÉ ch·ªânh s·ª≠a

    Note over HR,Bank: ‚îÅ‚îÅ‚îÅ NG√ÄY 2-3: T√çNH L∆Ø∆†NG T·ª∞ ƒê·ªòNG ‚îÅ‚îÅ‚îÅ
    
    HR->>App: 2. Ch·∫°y t√≠nh l∆∞∆°ng t·ª± ƒë·ªông
    App->>API: POST /api/payroll/calculate<br/>{month: 10, year: 2025}
    API->>PaySvc: calculatePayrollForMonth(10, 2025)
    
    PaySvc->>DB: SELECT employees<br/>WHERE status IN ('Active','OnLeave')
    DB-->>PaySvc: List of employees (45 ng∆∞·ªùi)
    
    loop T·ª´ng nh√¢n vi√™n
        PaySvc->>AttSvc: getMonthlyAttendance(emp_id, 10, 2025)
        AttSvc->>DB: SELECT attendance summary
        DB-->>AttSvc: Attendance data
        AttSvc-->>PaySvc: {<br/>  working_days: 24,<br/>  total_hours: 192,<br/>  overtime_hours: 12,<br/>  late_count: 2<br/>}
        
        PaySvc->>BonusSvc: getBonusAndPenalties(emp_id, 10, 2025)
        BonusSvc->>DB: SELECT bonuses, penalties
        DB-->>BonusSvc: Bonus/Penalty data
        BonusSvc-->>PaySvc: {<br/>  bonuses: 1,000,000ƒë,<br/>  penalties: -100,000ƒë<br/>}
        
        Note over PaySvc: ‚îÅ‚îÅ‚îÅ T√çNH TO√ÅN L∆Ø∆†NG ‚îÅ‚îÅ‚îÅ
        
        PaySvc->>PaySvc: 1. Base Salary<br/>= 8,000,000 √ó (24/26)<br/>= 7,384,615ƒë
        
        PaySvc->>PaySvc: 2. Allowances<br/>= Meal: 30k √ó 24 = 720k<br/>+ Gas: 500k<br/>= 1,220,000ƒë
        
        PaySvc->>PaySvc: 3. Overtime Pay<br/>= (8M/160) √ó 12h √ó 1.5<br/>= 900,000ƒë
        
        PaySvc->>PaySvc: 4. Gross Salary<br/>= 7,384,615 + 1,220,000<br/>+ 900,000 + 1,000,000<br/>- 100,000<br/>= 10,404,615ƒë
        
        PaySvc->>PaySvc: 5. Deductions<br/>‚Ä¢ BHXH (8%): 832,369ƒë<br/>‚Ä¢ BHYT (1.5%): 156,069ƒë<br/>‚Ä¢ BHTN (1%): 104,046ƒë<br/>‚Ä¢ TNCN: 500,000ƒë<br/>Total: 1,592,484ƒë
        
        PaySvc->>PaySvc: 6. Net Salary<br/>= 10,404,615 - 1,592,484<br/>= 8,812,131ƒë
        
        PaySvc->>DB: BEGIN TRANSACTION
        activate DB
        
        PaySvc->>DB: INSERT INTO payroll<br/>(employee_id, month, year,<br/>base, allowances, overtime,<br/>bonuses, penalties,<br/>gross, deductions, net,<br/>status='pending_approval')
        
        PaySvc->>DB: INSERT INTO payroll_items<br/>(type, description, amount)
        Note over PaySvc,DB: Chi ti·∫øt t·ª´ng kho·∫£n:<br/>Base, Meal, Gas, OT,<br/>Bonus, Penalty, BHXH...
        
        PaySvc->>DB: COMMIT
        deactivate DB
        
        PaySvc->>Mail: generatePayslip(emp_id)
        Mail->>Mail: Create PDF payslip
        Mail-->>PaySvc: Payslip PDF
    end
    
    PaySvc-->>API: Payroll calculated for 45 employees
    API-->>App: Calculation complete
    App-->>HR: ‚úÖ ƒê√£ t√≠nh l∆∞∆°ng 45 nh√¢n vi√™n<br/>T·ªïng chi: 396,546,000ƒë

    Note over HR,Bank: ‚îÅ‚îÅ‚îÅ NG√ÄY 4: DUY·ªÜT L∆Ø∆†NG ‚îÅ‚îÅ‚îÅ
    
    HR->>App: 3. Xem v√† ki·ªÉm tra b·∫£ng l∆∞∆°ng
    App->>API: GET /api/payroll?month=10&year=2025
    API->>PaySvc: getPayrollList(10, 2025)
    PaySvc->>DB: SELECT payroll with details
    DB-->>PaySvc: Payroll data
    PaySvc-->>API: Payroll list
    API-->>App: Display payroll
    App-->>HR: Hi·ªÉn th·ªã b·∫£ng l∆∞∆°ng chi ti·∫øt
    
    HR->>App: 4. Duy·ªát b·∫£ng l∆∞∆°ng
    App->>API: POST /api/payroll/batch-approve<br/>{payroll_ids: [...]}
    API->>PaySvc: approvePayroll(payroll_ids)
    
    PaySvc->>DB: UPDATE payroll<br/>SET status='approved',<br/>approved_by='HR-001',<br/>approved_at=NOW()
    
    PaySvc-->>API: Approved
    API-->>App: Success
    App-->>HR: ‚úÖ ƒê√£ duy·ªát l∆∞∆°ng
    
    par G·ª≠i payslip cho nh√¢n vi√™n
        PaySvc->>Mail: sendPayslipToAllEmployees()
        loop 45 nh√¢n vi√™n
            Mail->>Mail: Attach PDF payslip
            Mail-->>E: üìß [Payslip Th√°ng 10/2025]<br/>K√≠nh g·ª≠i anh/ch·ªã...<br/>L∆∞∆°ng th√°ng 10: 8,812,131ƒë
        end
    end

    Note over HR,Bank: ‚îÅ‚îÅ‚îÅ NG√ÄY 5: CHUY·ªÇN L∆Ø∆†NG ‚îÅ‚îÅ‚îÅ
    
    HR->>App: 5. Chuy·ªÉn l∆∞∆°ng qua ng√¢n h√†ng
    App->>API: POST /api/payroll/transfer<br/>{month: 10, year: 2025}
    API->>PaySvc: initiatePayment(10, 2025)
    
    PaySvc->>DB: SELECT payroll<br/>WHERE status='approved'
    DB-->>PaySvc: Payroll data with bank info
    
    PaySvc->>Bank: POST /banking/batch-transfer
    Note over PaySvc,Bank: G·ª≠i file batch transfer<br/>v·ªõi 45 giao d·ªãch
    
    Bank-->>PaySvc: Transfer initiated<br/>Transaction ID: TXN-12345
    
    PaySvc->>DB: UPDATE payroll<br/>SET status='paid',<br/>payment_date=NOW(),<br/>transaction_id='TXN-12345'
    
    PaySvc-->>API: Payment successful
    API-->>App: Success
    App-->>HR: ‚úÖ ƒê√£ chuy·ªÉn l∆∞∆°ng th√†nh c√¥ng<br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>S·ªë giao d·ªãch: 45<br/>T·ªïng ti·ªÅn: 396,546,000ƒë<br/>M√£ GD: TXN-12345
    
    Bank->>Mail: sendBankNotification()
    Mail-->>E: üìß [Ng√¢n h√†ng] B·∫°n nh·∫≠n ƒë∆∞·ª£c<br/>chuy·ªÉn kho·∫£n 8,812,131ƒë<br/>t·ª´ [Nh√† H√†ng ABC]
```

---

## 6Ô∏è‚É£ Sequence Diagram - Ph√¢n Quy·ªÅn RBAC

```mermaid
sequenceDiagram
    actor A as üë®‚Äçüíº Admin
    participant App as üì± Admin Panel
    participant API as üîß API Gateway
    participant AuthSvc as üîê Auth Service
    participant RoleSvc as üë• Role Service
    participant DB as üíæ Database

    A->>App: 1. V√†o m√†n h√¨nh ph√¢n quy·ªÅn
    App->>API: GET /api/roles
    API->>RoleSvc: getAllRoles()
    RoleSvc->>DB: SELECT roles with permissions
    DB-->>RoleSvc: Roles data
    RoleSvc-->>API: Roles list
    API-->>App: Roles data
    App-->>A: Hi·ªÉn th·ªã danh s√°ch roles

    A->>App: 2. Ch·ªçn nh√¢n vi√™n c·∫ßn ph√¢n quy·ªÅn
    App->>API: GET /api/employees/{employeeId}
    API->>AuthSvc: getEmployeeWithRoles(employeeId)
    AuthSvc->>DB: SELECT employee, roles, permissions
    DB-->>AuthSvc: Employee data
    AuthSvc-->>API: Employee with current roles
    API-->>App: Employee data
    App-->>A: Hi·ªÉn th·ªã th√¥ng tin NV v√† roles hi·ªán t·∫°i

    A->>App: 3. Ch·ªçn roles m·ªõi
    Note over A,App: Ch·ªçn: Manager, Cashier

    A->>App: 4. X√°c nh·∫≠n thay ƒë·ªïi
    App->>API: PUT /api/employees/{employeeId}/roles
    API->>AuthSvc: updateEmployeeRoles(employeeId, roles)
    
    AuthSvc->>DB: BEGIN TRANSACTION
    activate DB
    
    AuthSvc->>DB: DELETE FROM employee_roles<br/>WHERE employee_id = ?
    AuthSvc->>DB: INSERT INTO employee_roles<br/>(employee_id, role_id)
    
    AuthSvc->>DB: INSERT INTO audit_log<br/>(action='ROLE_CHANGED', ...)
    
    AuthSvc->>DB: COMMIT TRANSACTION
    deactivate DB
    
    AuthSvc->>AuthSvc: invalidateUserCache(employeeId)
    
    Note over AuthSvc: X√≥a cache permissions<br/>ƒë·ªÉ bu·ªôc reload
    
    AuthSvc-->>API: Roles updated
    API-->>App: Success
    App-->>A: ‚úÖ ƒê√£ c·∫≠p nh·∫≠t quy·ªÅn

    App->>API: 5. G·ª≠i th√¥ng b√°o ƒë·∫øn NV
    API->>AuthSvc: notifyRoleChanged(employeeId)
    AuthSvc-->>A: üìß Email: Quy·ªÅn c·ªßa b·∫°n ƒë√£ thay ƒë·ªïi
```

---

## 5Ô∏è‚É£ Sequence Diagram - Xem Dashboard Real-time

```mermaid
sequenceDiagram
    actor M as üëî Qu·∫£n L√Ω
    participant App as üì± Dashboard App
    participant API as üîß API Gateway
    participant DashSvc as üìä Dashboard Service
    participant Cache as üíæ Redis Cache
    participant DB as üíæ Database
    participant Analytics as üìà Analytics Engine

    M->>App: M·ªü dashboard
    App->>API: GET /api/dashboard/summary
    API->>DashSvc: getSummary(date)
    
    DashSvc->>Cache: GET dashboard:summary:{date}
    
    alt Cache hit
        Cache-->>DashSvc: Cached data
        DashSvc-->>API: Summary data (from cache)
    else Cache miss
        DashSvc->>DB: Query multiple tables
        
        par Parallel queries
            DashSvc->>DB: SELECT revenue FROM orders<br/>WHERE date = TODAY
            DashSvc->>DB: SELECT COUNT(*) FROM orders<br/>WHERE date = TODAY
            DashSvc->>DB: SELECT AVG(total) FROM orders<br/>WHERE date = TODAY
            DashSvc->>DB: SELECT stock_value<br/>FROM inventory_summary
            DashSvc->>DB: SELECT COUNT(*) FROM employees<br/>WHERE status = 'Working'
        end
        
        DB-->>DashSvc: Query results
        
        DashSvc->>Analytics: calculateTrends(data)
        Analytics-->>DashSvc: Trends data
        
        DashSvc->>Cache: SET dashboard:summary:{date}<br/>EX 300 (5 minutes)
        DashSvc-->>API: Summary data
    end
    
    API-->>App: Dashboard data
    App-->>M: Hi·ªÉn th·ªã dashboard
    
    Note over App: WebSocket connection<br/>for real-time updates
    
    loop Every 30 seconds
        App->>API: WS: Subscribe to updates
        API->>DashSvc: getRealtimeUpdates()
        DashSvc->>DB: SELECT new orders, payments
        DB-->>DashSvc: Latest data
        DashSvc-->>API: Updates
        API-->>App: WS: Push updates
        App->>App: Update UI without refresh
    end
```

---

## 6Ô∏è‚É£ State Diagram - V√≤ng ƒê·ªùi Nh√¢n Vi√™n

```mermaid
stateDiagram-v2
    [*] --> Recruited: Tuy·ªÉn d·ª•ng
    
    Recruited --> Onboarding: K√Ω h·ª£p ƒë·ªìng
    
    Onboarding --> Probation: B·∫Øt ƒë·∫ßu th·ª≠ vi·ªác
    
    Probation --> Active: ƒê·∫°t y√™u c·∫ßu th·ª≠ vi·ªác
    Probation --> Terminated: Kh√¥ng ƒë·∫°t
    
    Active --> OnLeave: Xin ngh·ªâ ph√©p
    Active --> Suspended: B·ªã ƒë√¨nh ch·ªâ
    Active --> Resigned: Xin ngh·ªâ vi·ªác
    Active --> Retired: Ngh·ªâ h∆∞u
    
    OnLeave --> Active: Quay l·∫°i l√†m vi·ªác
    
    Suspended --> Active: H·∫øt th·ªùi gian ƒë√¨nh ch·ªâ
    Suspended --> Terminated: B·ªã sa th·∫£i
    
    Resigned --> [*]
    Retired --> [*]
    Terminated --> [*]
    
    note right of Recruited
        V·ª´a tuy·ªÉn d·ª•ng
        Ch∆∞a b·∫Øt ƒë·∫ßu l√†m
    end note
    
    note right of Onboarding
        ƒê√†o t·∫°o ban ƒë·∫ßu
        L√†m quen m√¥i tr∆∞·ªùng
    end note
    
    note right of Probation
        Th·ª≠ vi·ªác 2 th√°ng
        ƒê√°nh gi√° nƒÉng l·ª±c
    end note
    
    note right of Active
        Nh√¢n vi√™n ch√≠nh th·ª©c
        ƒêang l√†m vi·ªác
    end note
```

---

## 7Ô∏è‚É£ ER Diagram - M√¥ H√¨nh D·ªØ Li·ªáu

```mermaid
erDiagram
    EMPLOYEE ||--o{ EMPLOYEE_ROLE : has
    EMPLOYEE ||--o{ SHIFT_ASSIGNMENT : assigned_to
    EMPLOYEE ||--o{ ATTENDANCE : records
    EMPLOYEE ||--o{ PAYROLL : receives
    EMPLOYEE ||--o| USER : has_account
    
    ROLE ||--o{ EMPLOYEE_ROLE : assigned_to
    ROLE ||--o{ ROLE_PERMISSION : has
    
    PERMISSION ||--o{ ROLE_PERMISSION : granted_to
    
    SHIFT ||--o{ SHIFT_ASSIGNMENT : contains
    
    ATTENDANCE ||--o{ PAYROLL_ITEM : affects
    
    PAYROLL ||--o{ PAYROLL_ITEM : contains
    
    EMPLOYEE {
        string id PK
        string full_name
        string id_number
        date date_of_birth
        string phone
        string email
        string address
        string position
        string department
        date hire_date
        enum contract_type
        decimal base_salary
        enum status
        string created_by FK
        datetime created_at
    }
    
    USER {
        string id PK
        string employee_id FK
        string username UK
        string email UK
        string password_hash
        bool is_active
        datetime last_login
    }
    
    ROLE {
        string id PK
        string name UK
        string description
        int priority
        bool is_system
    }
    
    PERMISSION {
        string id PK
        string module
        string action
        string description
    }
    
    EMPLOYEE_ROLE {
        string id PK
        string employee_id FK
        string role_id FK
        date assigned_at
        string assigned_by FK
    }
    
    ROLE_PERMISSION {
        string id PK
        string role_id FK
        string permission_id FK
    }
    
    SHIFT {
        string id PK
        string name
        time start_time
        time end_time
        int duration_hours
    }
    
    SHIFT_ASSIGNMENT {
        string id PK
        string employee_id FK
        string shift_id FK
        date work_date
        enum status
    }
    
    ATTENDANCE {
        string id PK
        string employee_id FK
        date work_date
        datetime check_in
        datetime check_out
        decimal total_hours
        decimal overtime_hours
        enum status
    }
    
    PAYROLL {
        string id PK
        string employee_id FK
        int month
        int year
        decimal base_salary
        decimal total_allowances
        decimal total_overtime
        decimal total_bonuses
        decimal total_penalties
        decimal gross_salary
        decimal total_deductions
        decimal net_salary
        enum status
        date payment_date
    }
    
    PAYROLL_ITEM {
        string id PK
        string payroll_id FK
        enum item_type
        string description
        decimal amount
    }
```

---

## 8Ô∏è‚É£ Business Rules - Quy T·∫Øc Nghi·ªáp V·ª•

### üë• Quy T·∫Øc Nh√¢n Vi√™n

#### **M√£ Nh√¢n Vi√™n**
- Format: `EMP-xxxxx` (5 ch·ªØ s·ªë)
- T·ª± ƒë·ªông t·∫°o khi th√™m NV m·ªõi
- Kh√¥ng thay ƒë·ªïi, duy nh·∫•t

#### **Tr·∫°ng Th√°i**
| Status | M√¥ T·∫£ | C√≥ th·ªÉ ƒëƒÉng nh·∫≠p? |
|--------|-------|-------------------|
| **Recruited** | V·ª´a tuy·ªÉn | ‚ùå Kh√¥ng |
| **Onboarding** | ƒê√†o t·∫°o | ‚úÖ C√≥ (h·∫°n ch·∫ø) |
| **Probation** | Th·ª≠ vi·ªác | ‚úÖ C√≥ |
| **Active** | Ch√≠nh th·ª©c | ‚úÖ C√≥ |
| **OnLeave** | Ngh·ªâ ph√©p | ‚ö†Ô∏è H·∫°n ch·∫ø |
| **Suspended** | ƒê√¨nh ch·ªâ | ‚ùå Kh√¥ng |
| **Resigned** | ƒê√£ ngh·ªâ | ‚ùå Kh√¥ng |
| **Terminated** | B·ªã sa th·∫£i | ‚ùå Kh√¥ng |

### üîê Quy T·∫Øc Ph√¢n Quy·ªÅn (RBAC)

#### **C·∫•u Tr√∫c**
```
User ‚Üí Roles ‚Üí Permissions ‚Üí Resources
```

#### **7 Roles Ch√≠nh**
| Role | Priority | M√¥ T·∫£ |
|------|----------|-------|
| **super_admin** | 1 | To√†n quy·ªÅn h·ªá th·ªëng |
| **admin** | 2 | Qu·∫£n tr·ªã h·ªá th·ªëng |
| **manager** | 3 | Qu·∫£n l√Ω nh√† h√†ng |
| **staff** | 4 | Nh√¢n vi√™n vƒÉn ph√≤ng |
| **cashier** | 5 | Thu ng√¢n |
| **kitchen** | 6 | B·∫øp |
| **waiter** | 7 | Ph·ª•c v·ª• |

#### **Permission Format**
```
{module}:{action}
```
V√≠ d·ª•:
- `users:view` - Xem danh s√°ch user
- `orders:create` - T·∫°o order
- `invoices:delete` - X√≥a h√≥a ƒë∆°n

#### **Ki·ªÉm Tra Quy·ªÅn**
```javascript
function hasPermission(user, permission) {
  // 1. L·∫•y t·∫•t c·∫£ roles c·ªßa user
  const userRoles = getUserRoles(user.id);
  
  // 2. L·∫•y t·∫•t c·∫£ permissions c·ªßa c√°c roles
  const permissions = [];
  for (const role of userRoles) {
    permissions.push(...getRolePermissions(role.id));
  }
  
  // 3. Ki·ªÉm tra permission c√≥ trong danh s√°ch kh√¥ng
  return permissions.includes(permission);
}
```

### ‚è∞ Quy T·∫Øc Ch·∫•m C√¥ng

#### **Ca L√†m Vi·ªác**
| Ca | Gi·ªù | Th·ªùi gian ngh·ªâ |
|----|-----|----------------|
| **S√°ng** | 06:00 - 14:00 | 11:00-11:30 |
| **Chi·ªÅu** | 14:00 - 22:00 | 17:00-17:30 |
| **T·ªëi** | 22:00 - 06:00 | 01:00-01:30 |

#### **Quy ƒê·ªãnh ƒêi Mu·ªôn**
- **< 5 ph√∫t**: Kh√¥ng ph·∫°t
- **5-15 ph√∫t**: C·∫£nh c√°o, kh√¥ng ph·∫°t ti·ªÅn
- **15-30 ph√∫t**: Ph·∫°t 50,000ƒë
- **> 30 ph√∫t**: Ph·∫°t 100,000ƒë + c·∫£nh c√°o
- **> 3 l·∫ßn/th√°ng**: ƒê√¨nh ch·ªâ 1 ng√†y

#### **T√≠nh Overtime**
```
overtime_rate = {
  weekday: 1.5,      // 150% l∆∞∆°ng
  weekend: 2.0,      // 200% l∆∞∆°ng
  holiday: 3.0       // 300% l∆∞∆°ng
}

overtime_pay = (base_salary / 160) √ó overtime_hours √ó rate
```
- 160 = s·ªë gi·ªù chu·∫©n/th√°ng (8h √ó 20 ng√†y)

### üí∞ Quy T·∫Øc T√≠nh L∆∞∆°ng

#### **C√¥ng Th·ª©c**
```
gross_salary = base_salary + allowances + overtime_pay + bonuses - penalties

deductions = {
  BHXH: gross_salary √ó 0.08,    // 8%
  BHYT: gross_salary √ó 0.015,   // 1.5%
  BHTN: gross_salary √ó 0.01,    // 1%
  TNCN: calculateTax(gross_salary)
}

net_salary = gross_salary - SUM(deductions)
```

#### **Ph·ª• C·∫•p**
| Lo·∫°i | S·ªë Ti·ªÅn | ƒêi·ªÅu Ki·ªán |
|------|---------|-----------|
| **ƒÇn ca** | 30,000ƒë/ng√†y | L√†m full ca |
| **XƒÉng xe** | 500,000ƒë/th√°ng | C√≥ xe ƒëi l√†m |
| **ƒêi·ªán tho·∫°i** | 200,000ƒë/th√°ng | Qu·∫£n l√Ω tr·ªü l√™n |
| **Tr√°ch nhi·ªám** | 1,000,000ƒë/th√°ng | Manager |

#### **Th∆∞·ªüng**
- **Th√°ng 13**: 1 th√°ng l∆∞∆°ng (cu·ªëi nƒÉm)
- **KPI**: 10-30% l∆∞∆°ng (theo performance)
- **L·ªÖ T·∫øt**: 500,000ƒë - 2,000,000ƒë

#### **Ph·∫°t**
- ƒêi mu·ªôn: 50,000ƒë - 100,000ƒë
- Ngh·ªâ kh√¥ng ph√©p: 200,000ƒë/ng√†y
- Vi ph·∫°m quy ƒë·ªãnh: 500,000ƒë - 2,000,000ƒë

---

## 9Ô∏è‚É£ API Endpoints - Danh S√°ch API

### Employee Management

#### CRUD Nh√¢n Vi√™n
```http
# Danh s√°ch nh√¢n vi√™n
GET /api/employees?status=Active&department=Kitchen

# Chi ti·∫øt nh√¢n vi√™n
GET /api/employees/{employeeId}

# T·∫°o nh√¢n vi√™n m·ªõi
POST /api/employees
Body: {
  "full_name": "Nguy·ªÖn VƒÉn A",
  "id_number": "001234567890",
  "date_of_birth": "1990-01-01",
  "phone": "0901234567",
  "email": "nva@restaurant.com",
  "position": "Waiter",
  "department": "Service",
  "base_salary": 8000000,
  "hire_date": "2025-10-22"
}

# C·∫≠p nh·∫≠t nh√¢n vi√™n
PUT /api/employees/{employeeId}

# V√¥ hi·ªáu h√≥a nh√¢n vi√™n
POST /api/employees/{employeeId}/deactivate
Body: {
  "reason": "Resigned",
  "last_working_date": "2025-10-31"
}
```

### Role & Permission Management

#### Ph√¢n Quy·ªÅn
```http
# Danh s√°ch roles
GET /api/roles

# Chi ti·∫øt role v·ªõi permissions
GET /api/roles/{roleId}

# G√°n roles cho nh√¢n vi√™n
PUT /api/employees/{employeeId}/roles
Body: {
  "role_ids": ["ROLE-001", "ROLE-002"]
}

# Ki·ªÉm tra quy·ªÅn
POST /api/auth/check-permission
Body: {
  "user_id": "USR-001",
  "permission": "orders:create"
}
Response: {
  "has_permission": true
}
```

### Attendance Management

#### Ch·∫•m C√¥ng
```http
# Check-in
POST /api/attendance/check-in
Body: {
  "employee_id": "EMP-001",
  "location": {
    "lat": 10.762622,
    "lng": 106.660172
  }
}

# Check-out
POST /api/attendance/check-out
Body: {
  "employee_id": "EMP-001"
}

# B·∫£ng ch·∫•m c√¥ng th√°ng
GET /api/attendance?employee_id=EMP-001&month=10&year=2025
Response: {
  "employee_id": "EMP-001",
  "month": 10,
  "year": 2025,
  "total_working_days": 24,
  "total_hours": 192,
  "overtime_hours": 12,
  "late_count": 2,
  "absent_count": 0,
  "records": [...]
}
```

### Payroll Management

#### T√≠nh L∆∞∆°ng
```http
# T·∫°o b·∫£ng l∆∞∆°ng th√°ng
POST /api/payroll/calculate
Body: {
  "month": 10,
  "year": 2025,
  "employee_ids": ["EMP-001", "EMP-002"]
}

# Xem payslip
GET /api/payroll/{payrollId}
Response: {
  "payroll_id": "PAY-001",
  "employee_name": "Nguy·ªÖn VƒÉn A",
  "month": "10/2025",
  "base_salary": 8000000,
  "allowances": 600000,
  "overtime": 450000,
  "bonuses": 1000000,
  "penalties": -100000,
  "gross_salary": 9950000,
  "deductions": {
    "BHXH": 796000,
    "BHYT": 149250,
    "BHTN": 99500,
    "TNCN": 500000
  },
  "net_salary": 8405250
}

# Duy·ªát b·∫£ng l∆∞∆°ng
POST /api/payroll/{payrollId}/approve
```

### Dashboard

#### Dashboard T·ªïng Quan
```http
GET /api/dashboard/summary?date=2025-10-21
Response: {
  "revenue": {
    "today": 15000000,
    "yesterday": 12000000,
    "change_percent": 25
  },
  "orders": {
    "today": 125,
    "yesterday": 98,
    "change_percent": 27.55
  },
  "customers": {
    "today": 280,
    "yesterday": 245
  },
  "inventory_value": 25000000,
  "staff_working": 18,
  "tables_occupied": 12
}
```

---

## üîü Screen Mockups - Giao Di·ªán Tham Kh·∫£o

### Dashboard T·ªïng Quan
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          üìä DASHBOARD - T·ªïng Quan H·ªá Th·ªëng             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üìÖ Ng√†y: 21/10/2025                    üë§ Admin: H√πng  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                           ‚îÇ
‚îÇ üí∞ DOANH THU H√îM NAY         üì¶ ƒê∆†N H√ÄNG               ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ ‚îÇ   15,000,000ƒë    ‚îÇ         ‚îÇ       125        ‚îÇ      ‚îÇ
‚îÇ ‚îÇ   ‚ñ≤ +25% so h√¥m qua‚îÇ         ‚îÇ   ‚ñ≤ +27.55%      ‚îÇ      ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ üë• KH√ÅCH H√ÄNG                üìä T·ªíN KHO                ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ ‚îÇ       280        ‚îÇ         ‚îÇ  25,000,000ƒë     ‚îÇ      ‚îÇ
‚îÇ ‚îÇ   ‚ñ≤ +14.29%      ‚îÇ         ‚îÇ   üü¢ ·ªîn ƒë·ªãnh     ‚îÇ      ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ      ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ üìà BI·ªÇU ƒê·ªí DOANH THU 7 NG√ÄY QUA                        ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ ‚îÇ 15M ‚îÇ         ‚ï±‚ï≤                            ‚ñ≤   ‚îÇ    ‚îÇ
‚îÇ ‚îÇ 12M ‚îÇ      ‚ï±‚ï≤‚ï±  ‚ï≤      ‚ï±‚ï≤                  ‚ï±‚îÇ   ‚îÇ    ‚îÇ
‚îÇ ‚îÇ  9M ‚îÇ    ‚ï±‚ï≤      ‚ï≤‚ï±‚ï≤‚ï±‚ï≤‚ï±  ‚ï≤              ‚ï±‚ï≤‚ï± ‚îÇ   ‚îÇ    ‚îÇ
‚îÇ ‚îÇ  6M ‚îÇ  ‚ï±‚ï≤                  ‚ï≤‚ï±‚ï≤        ‚ï±‚ï≤    ‚îÇ   ‚îÇ    ‚îÇ
‚îÇ ‚îÇ  3M ‚îÇ‚ï±‚ï≤                        ‚ï≤‚ï±‚ï≤‚ï±‚ï≤‚ï±      ‚îÇ   ‚îÇ    ‚îÇ
‚îÇ ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   ‚îÇ    ‚îÇ
‚îÇ ‚îÇ      15  16  17  18  19  20  21            ‚îÇ   ‚îÇ    ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ üî• TOP 5 M√ìN B√ÅN CH·∫†Y       ‚ö†Ô∏è C·∫¢NH B√ÅO                ‚îÇ
‚îÇ 1. Ph·ªü B√≤ (45 ƒë∆°n)          ‚Ä¢ 8 NVL s·∫Øp h·∫øt             ‚îÇ
‚îÇ 2. B√∫n B√≤ (32 ƒë∆°n)          ‚Ä¢ 2 thi·∫øt b·ªã c·∫ßn b·∫£o tr√¨   ‚îÇ
‚îÇ 3. C∆°m T·∫•m (28 ƒë∆°n)         ‚Ä¢ 3 NV c·∫ßn ƒë√†o t·∫°o         ‚îÇ
‚îÇ                                                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### M√†n H√¨nh Qu·∫£n L√Ω Nh√¢n Vi√™n
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          üë• QU·∫¢N L√ù NH√ÇN VI√äN                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üîç [_________]  üìÅ [T·∫•t c·∫£ ‚ñº]  üè¢ [B·ªô ph·∫≠n ‚ñº]         ‚îÇ
‚îÇ [ ‚ûï Th√™m Nh√¢n Vi√™n ]  [ üìä B√°o C√°o ]                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                           ‚îÇ
‚îÇ M√£      ‚îÇ H·ªç T√™n       ‚îÇ V·ªã tr√≠  ‚îÇ Ca    ‚îÇ Tr·∫°ng th√°i  ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ EMP-001 ‚îÇ Nguy·ªÖn VƒÉn A ‚îÇ Waiter  ‚îÇ S√°ng  ‚îÇ üü¢ Active   ‚îÇ
‚îÇ EMP-002 ‚îÇ Tr·∫ßn Th·ªã B   ‚îÇ Cashier ‚îÇ Chi·ªÅu ‚îÇ üü¢ Active   ‚îÇ
‚îÇ EMP-003 ‚îÇ L√™ VƒÉn C     ‚îÇ Chef    ‚îÇ Chi·ªÅu ‚îÇ üü° OnLeave  ‚îÇ
‚îÇ EMP-004 ‚îÇ Ph·∫°m Th·ªã D   ‚îÇ Manager ‚îÇ Full  ‚îÇ üü¢ Active   ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ [ üëÅÔ∏è Xem ] [ ‚úèÔ∏è S·ª≠a ] [ üîê Ph√¢n Quy·ªÅn ] [ ‚è∞ Ch·∫•m C√¥ng ]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 1Ô∏è‚É£1Ô∏è‚É£ Security Best Practices - Th·ª±c H√†nh B·∫£o M·∫≠t

### üîê Authentication & Authorization
1. **JWT Token**: Access token 60 ph√∫t, Refresh token 30 ng√†y
2. **Password Policy**: 
   - T·ªëi thi·ªÉu 8 k√Ω t·ª±
   - Bao g·ªìm ch·ªØ hoa, ch·ªØ th∆∞·ªùng, s·ªë, k√Ω t·ª± ƒë·∫∑c bi·ªát
   - Hash b·∫±ng bcrypt (cost factor 12)
3. **MFA**: B·∫Øt bu·ªôc cho Admin v√† Manager
4. **Session Management**: Logout t·ª± ƒë·ªông sau 30 ph√∫t kh√¥ng ho·∫°t ƒë·ªông

### üìù Audit Log
Ghi l·∫°i m·ªçi thao t√°c quan tr·ªçng:
- User login/logout
- Thay ƒë·ªïi quy·ªÅn
- T·∫°o/s·ª≠a/x√≥a d·ªØ li·ªáu quan tr·ªçng
- Thanh to√°n, nh·∫≠p/xu·∫•t kho

Format:
```json
{
  "timestamp": "2025-10-21T12:00:00Z",
  "user_id": "USR-001",
  "action": "UPDATE",
  "resource": "employees",
  "resource_id": "EMP-001",
  "changes": {
    "base_salary": {"old": 8000000, "new": 9000000}
  },
  "ip_address": "192.168.1.100",
  "user_agent": "Mozilla/5.0..."
}
```

---

**[‚¨ÖÔ∏è Quay l·∫°i: Menu & Promotion](./05-MENU-PROMOTION-MANAGEMENT.md)** | **[üè† V·ªÅ Index](./00-INDEX.md)**
